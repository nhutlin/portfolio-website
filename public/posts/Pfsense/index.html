<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Install and config: Pfsense &middot; Gangi&#39;s</title>
  <meta name="title" content="Install and config: Pfsense &middot; Gangi&#39;s" />
  
  
  <meta name="keywords" content="firewall, devops, visual, " />
  
  
  <link rel="canonical" href="http://localhost:1313/posts/pfsense/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.59d2d4af6a47a16d8c6d998ee8baea3265a1cb5af978d75da51aadcd7cbdca5a5aa7cf8a6cd1b3d54bc1a943aa03373fa3c564db9d2509b0c18c531981ad6117.css"
    integrity="sha512-WdLUr2pHoW2MbZmO6LrqMmWhy1r5eNddpRqtzXy9ylpap8&#43;KbNGz1UvBqUOqAzc/o8Vk250lCbDBjFMZga1hFw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.827fa4e4523276d4fbafeb177baab022781a885b35699f60775ce8fdb94f87df6088e5e5555d1846206d67806aa47399593ea04bda1fff30dc398aaf5e718ec9.js"
    integrity="sha512-gn&#43;k5FIydtT7r&#43;sXe6qwIngaiFs1aZ9gd1zo/blPh99giOXlVV0YRiBtZ4BqpHOZWT6gS9of/zDcOYqvXnGOyQ==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.fcbc7f7b3dcea96e3b5570cd322c5d7a12d5351c87f9889b1c31745a2cc711df58f6b70795a86d50e63813b236ade916668332c10a70a4ce26f7c0878f525fce.js" integrity="sha512-/Lx/ez3OqW47VXDNMixdehLVNRyH&#43;YibHDF0WizHEd9Y9rcHlahtUOY4E7I2rekWZoMywQpwpM4m98CHj1Jfzg=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/posts/pfsense/">
  <meta property="og:site_name" content="Gangi&#39;s">
  <meta property="og:title" content="Install and config: Pfsense">
  <meta property="og:description" content="Pfsense, Client to Site &amp; Site to site #Table of contents #Pfsense, Client to Site &amp; Site to site Table of contents What is Pfsense ? Features in pfsense Setup firewall (Outscope) Initial setup General Information Time Server Configuration WAN Interface Configuration Configure LAN Interface Change the Admin password Save parameters Configure Interface Configure Rule and NAT(port-forward) I. Rule WAN interface II. Rule LAN interface Setup firewall (Inscope Non CDE) Build VPN Setup VPN Client to Site Step 1: Configure WAN interface Step 2: Create a Virtual IP Step 3: Create Certificate Authority – CA Step 4: Create Server Certificate Step 5: Create a VPN – OpenVPN Server Step 6: Create a VPN – OpenVPN Client Step 7: Install the OpenVPN Client Export Utility, a tool that helps export the VPN client Step 8 : Create user OpenVPN Step 9: Configure access permissions in the VPN Step 10: Configure access to the VPN Step 11: Configure NAT outbound Step 12: Export the VPN Client installation package Step 13: Test the OpenVPN connection Setup VPN Site to site Setup Network on CMC-Cloud Site HCM Configure Interface OutScope, NonCDE, CDE Site HCM Configure the IPSec tunnel Site HCM Configure Firewall for local connections Site HCM Config Route table in CMC-Cloud on Site HCM Setup Network on CMC-Cloud Site HN Configure Interface OutScope, NonCDE, CDE Site HN Configure the IPSec tunnel Site HN Configure Firewall for local connections Site HN Config Route table in CMC-Cloud on Site HN Build VPN Route Base (Using OSPF) Routed IPsec (VTI) HANOI - Khanh’s zone (Vùng 1) - PHAN HCM - Khanh’s zone (Vùng 2) - GIANG HCM - Tram’s zone (Vùng 3) - TRI Step 1: Configure IPsec Tunnel on pfSense Step 2: Configure Phase 2 (Child SA) for VTI Create the VTI Interface Step 4: Firewall Rules for the VTI Interface Testing the VTI Tunnel Step 5: Setup for OSPF on pfSense with VTI I. Install the FRR Package on pfSense II. Configure FRR Global Settings III. Configure OSPF in FRR IV. Configure Static Routing in Pfsense V. Check status OSPF in FRR V. Check ping Build VPN With GRE-TUNNEL What is Pfsense ? #Pfsense: is an application that functions as a network firewall router and is free based on FreeBSD. Pfsense is configured through a web GUI interface for easy management and customization. It supports filtering based on source address, destination, source port, destination port, supports routing, and can operate in bridge or transparent mode.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-10-31T20:28:53+07:00">
    <meta property="article:modified_time" content="2024-10-31T20:28:53+07:00">
    <meta property="article:tag" content="Firewall">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Visual">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Install and config: Pfsense">
  <meta name="twitter:description" content="Pfsense, Client to Site &amp; Site to site #Table of contents #Pfsense, Client to Site &amp; Site to site Table of contents What is Pfsense ? Features in pfsense Setup firewall (Outscope) Initial setup General Information Time Server Configuration WAN Interface Configuration Configure LAN Interface Change the Admin password Save parameters Configure Interface Configure Rule and NAT(port-forward) I. Rule WAN interface II. Rule LAN interface Setup firewall (Inscope Non CDE) Build VPN Setup VPN Client to Site Step 1: Configure WAN interface Step 2: Create a Virtual IP Step 3: Create Certificate Authority – CA Step 4: Create Server Certificate Step 5: Create a VPN – OpenVPN Server Step 6: Create a VPN – OpenVPN Client Step 7: Install the OpenVPN Client Export Utility, a tool that helps export the VPN client Step 8 : Create user OpenVPN Step 9: Configure access permissions in the VPN Step 10: Configure access to the VPN Step 11: Configure NAT outbound Step 12: Export the VPN Client installation package Step 13: Test the OpenVPN connection Setup VPN Site to site Setup Network on CMC-Cloud Site HCM Configure Interface OutScope, NonCDE, CDE Site HCM Configure the IPSec tunnel Site HCM Configure Firewall for local connections Site HCM Config Route table in CMC-Cloud on Site HCM Setup Network on CMC-Cloud Site HN Configure Interface OutScope, NonCDE, CDE Site HN Configure the IPSec tunnel Site HN Configure Firewall for local connections Site HN Config Route table in CMC-Cloud on Site HN Build VPN Route Base (Using OSPF) Routed IPsec (VTI) HANOI - Khanh’s zone (Vùng 1) - PHAN HCM - Khanh’s zone (Vùng 2) - GIANG HCM - Tram’s zone (Vùng 3) - TRI Step 1: Configure IPsec Tunnel on pfSense Step 2: Configure Phase 2 (Child SA) for VTI Create the VTI Interface Step 4: Firewall Rules for the VTI Interface Testing the VTI Tunnel Step 5: Setup for OSPF on pfSense with VTI I. Install the FRR Package on pfSense II. Configure FRR Global Settings III. Configure OSPF in FRR IV. Configure Static Routing in Pfsense V. Check status OSPF in FRR V. Check ping Build VPN With GRE-TUNNEL What is Pfsense ? #Pfsense: is an application that functions as a network firewall router and is free based on FreeBSD. Pfsense is configured through a web GUI interface for easy management and customization. It supports filtering based on source address, destination, source port, destination port, supports routing, and can operate in bridge or transparent mode.">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Install and config: Pfsense",
    "headline": "Install and config: Pfsense",
    
    "abstract": "\u003ch1 class=\u0022relative group\u0022\u003ePfsense, Client to Site \u0026amp;  Site to site \r\n    \u003cdiv id=\u0022pfsense-client-to-site---site-to-site\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\u0022\u003e\r\n        \u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022\r\n            style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#pfsense-client-to-site---site-to-site\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\r\n    \u003c\/span\u003e        \r\n    \r\n\u003c\/h1\u003e\r\n\r\n\r\n\u003ch2 class=\u0022relative group\u0022\u003eTable of contents \r\n    \u003cdiv id=\u0022table-of-contents\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\u0022\u003e\r\n        \u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022\r\n            style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#table-of-contents\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\r\n    \u003c\/span\u003e        \r\n    \r\n\u003c\/h2\u003e\r\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#pfsense-client-to-site---site-to-site\u0022\u003ePfsense, Client to Site \u0026amp;  Site to site\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#table-of-contents\u0022\u003eTable of contents\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#what-is-pfsense-\u0022\u003eWhat is Pfsense ?\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#features-in-pfsense\u0022\u003eFeatures in pfsense\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#setup-firewall-outscope\u0022\u003eSetup firewall (Outscope)\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#initial-setup\u0022\u003eInitial setup\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#general-information\u0022\u003eGeneral Information\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#time-server-configuration\u0022\u003eTime Server Configuration\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#wan-interface-configuration\u0022\u003eWAN Interface Configuration\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-lan-interface\u0022\u003eConfigure LAN Interface\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#change-the-admin-password\u0022\u003eChange the Admin password\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#save-parameters\u0022\u003eSave parameters\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-interface\u0022\u003eConfigure Interface\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-rule-and-natport-forward\u0022\u003eConfigure Rule and NAT(port-forward)\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#i-rule-wan-interface\u0022\u003eI. Rule WAN interface\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#ii-rule-lan-interface\u0022\u003eII. Rule LAN interface\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#setup-firewall-inscope-non-cde\u0022\u003eSetup firewall (Inscope Non CDE)\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#build-vpn\u0022\u003eBuild VPN\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#setup-vpn-client-to-site\u0022\u003eSetup VPN Client to Site\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#step-1-configure-wan-interface\u0022\u003eStep 1: Configure WAN interface\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-2-create-a-virtual-ip\u0022\u003eStep 2: Create a Virtual IP\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-3-create-certificate-authority--ca\u0022\u003eStep 3: Create Certificate Authority – CA\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-4-create-server-certificate\u0022\u003eStep 4: Create Server Certificate\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-5-create-a-vpn--openvpn-server\u0022\u003eStep 5: Create a VPN – OpenVPN Server\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-6-create-a-vpn--openvpn-client\u0022\u003eStep 6: Create a VPN – OpenVPN Client\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-7-install-the-openvpn-client-export-utility-a-tool-that-helps-export-the-vpn-client\u0022\u003eStep 7: Install the OpenVPN Client Export Utility, a tool that helps export the VPN client\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-8--create-user-openvpn\u0022\u003eStep 8 : Create user OpenVPN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-9-configure-access-permissions-in-the-vpn\u0022\u003eStep 9: Configure access permissions in the VPN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-10-configure-access-to-the-vpn\u0022\u003eStep 10: Configure access to the VPN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-11-configure-nat-outbound\u0022\u003eStep 11: Configure NAT outbound\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-12-export-the-vpn-client-installation-package\u0022\u003eStep 12: Export the VPN Client installation package\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-13-test-the-openvpn-connection\u0022\u003eStep 13: Test the OpenVPN connection\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#setup-vpn-site-to-site\u0022\u003eSetup VPN Site to site\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#setup-network-on-cmc-cloud-site-hcm\u0022\u003eSetup Network on CMC-Cloud Site HCM\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-interface-outscope-noncde-cde-site-hcm\u0022\u003eConfigure Interface OutScope, NonCDE, CDE Site HCM\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-the-ipsec-tunnel-site-hcm\u0022\u003eConfigure the IPSec tunnel Site HCM\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-firewall-for-local-connections-site-hcm\u0022\u003eConfigure Firewall for local connections Site HCM\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#config-route-table-in-cmc-cloud-on-site-hcm\u0022\u003eConfig Route table in CMC-Cloud on Site HCM\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#setup-network-on-cmc-cloud-site-hn\u0022\u003eSetup Network on CMC-Cloud Site HN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-interface-outscope-noncde-cde-site-hn\u0022\u003eConfigure Interface OutScope, NonCDE, CDE Site HN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-the-ipsec-tunnel-site-hn\u0022\u003eConfigure the IPSec tunnel Site HN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#configure-firewall-for-local-connections-site-hn\u0022\u003eConfigure Firewall for local connections Site HN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#config-route-table-in-cmc-cloud-on-site-hn\u0022\u003eConfig Route table in CMC-Cloud on Site HN\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#build-vpn-route-base-using-ospf\u0022\u003eBuild VPN Route Base (Using OSPF)\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#routed-ipsec-vti\u0022\u003eRouted IPsec (VTI)\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#hanoi---khanhs-zone-v%c3%b9ng-1---phan\u0022\u003eHANOI - Khanh\u0026rsquo;s zone (Vùng 1) - PHAN\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#hcm---khanhs-zone-v%c3%b9ng-2---giang\u0022\u003eHCM - Khanh\u0026rsquo;s zone (Vùng 2) - GIANG\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#hcm---trams-zone-v%c3%b9ng-3---tri\u0022\u003eHCM - Tram\u0026rsquo;s zone (Vùng 3) - TRI\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-1-configure-ipsec-tunnel-on-pfsense\u0022\u003eStep 1: Configure IPsec Tunnel on pfSense\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-2-configure-phase-2-child-sa-for-vti\u0022\u003eStep 2: Configure Phase 2 (Child SA) for VTI\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#create-the-vti-interface\u0022\u003eCreate the VTI Interface\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-4-firewall-rules-for-the-vti-interface\u0022\u003eStep 4: Firewall Rules for the VTI Interface\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#testing-the-vti-tunnel\u0022\u003eTesting the VTI Tunnel\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#step-5-setup-for-ospf-on-pfsense-with-vti\u0022\u003eStep 5: Setup for OSPF on pfSense with VTI\u003c\/a\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\u0022#i-install-the-frr-package-on-pfsense\u0022\u003eI. Install the FRR Package on pfSense\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#ii-configure-frr-global-settings\u0022\u003eII. Configure FRR Global Settings\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#iii-configure-ospf-in-frr\u0022\u003eIII. Configure OSPF in FRR\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#iv-configure-static-routing-in-pfsense\u0022\u003eIV. Configure Static Routing in Pfsense\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#v-check-status-ospf-in-frr\u0022\u003eV. Check status OSPF in FRR\u003c\/a\u003e\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#v-check-ping\u0022\u003eV. Check ping\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003cli\u003e\u003ca href=\u0022#build-vpn-with-gre-tunnel\u0022\u003eBuild VPN With GRE-TUNNEL\u003c\/a\u003e\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003c\/li\u003e\n\u003c\/ul\u003e\n\r\n\r\n\u003ch3 class=\u0022relative group\u0022\u003eWhat is Pfsense ? \r\n    \u003cdiv id=\u0022what-is-pfsense-\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\r\n    \r\n    \u003cspan\r\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100\u0022\u003e\r\n        \u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022\r\n            style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#what-is-pfsense-\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\r\n    \u003c\/span\u003e        \r\n    \r\n\u003c\/h3\u003e\r\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ePfsense\u003c\/code\u003e\u003c\/strong\u003e: is an application that functions as a network firewall router and is free based on \u003ccode\u003eFreeBSD\u003c\/code\u003e. Pfsense is configured through a web GUI interface for easy management and customization. It supports filtering based on source address, destination, source port, destination port, supports routing, and can operate in bridge or transparent mode.\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/pfsense\/",
    "author" : {
      "@type": "Person",
      "name": "Truong-Giang Nguyen"
    },
    "copyrightYear": "2024",
    "dateCreated": "2024-10-31T20:28:53\u002b07:00",
    "datePublished": "2024-10-31T20:28:53\u002b07:00",
    
    "dateModified": "2024-10-31T20:28:53\u002b07:00",
    
    "keywords": ["firewall","devops","visual"],
    
    "mainEntityOfPage": "true",
    "wordCount": "6095"
  }]
  </script>


  
  
  <meta name="author" content="Truong-Giang Nguyen" />
  
  
  
  <link href="mailto:giangnt1891@gmail.com" rel="me" />
  
  
  <link href="https://github.com/giang2424" rel="me" />
  
  
  <link href="https://linkedin.com/in/gangint" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.03cb160e3cfdb2667a2e2c80d283bebcf63ff8bbc4b629c9ab2babf6fae1d0c07ad470edae783efa4fabda2ac01c58d60e63b98b3c336be8208460f08f4354f5.js" integrity="sha512-A8sWDjz9smZ6LiyA0oO&#43;vPY/&#43;LvEtinJqyur9vrh0MB61HDtrng&#43;&#43;k&#43;r2irAHFjWDmO5izwza&#43;gghGDwj0NU9Q=="></script>











<link type="text/css" rel="stylesheet" href="/lib/katex/katex.min.9a243bd9a824b2db256f73c9cc08fb4324ade4b3561b6be07f389ca3d8f7fa47c89542d2c842370a70ca90adaa9a870142bc63b4ffc147db7c29696bc107c761.css" integrity="sha512-miQ72agkstslb3PJzAj7QySt5LNWG2vgfzico9j3&#43;kfIlULSyEI3CnDKkK2qmocBQrxjtP/BR9t8KWlrwQfHYQ==" />


<script defer src="/lib/katex/katex.min.8c68eaeb75cfdcfac071717a969e1b9d9230ad52c6a2ac21ff846eaf6a258364cbb79e5e3552e32c280faeb4f4eda4d7c5bd1492e30a961c737e1e5305300281.js" integrity="sha512-jGjq63XP3PrAcXF6lp4bnZIwrVLGoqwh/4Rur2olg2TLt55eNVLjLCgPrrT07aTXxb0UkuMKlhxzfh5TBTACgQ=="></script>


<script defer src="/lib/katex/auto-render.min.e9b2833d28623d18c071d78ef13e9c79d695122d296af3dbcee7bf1bf6518b0565bab59939267fbc8f5faf696193c20f5caef3e7501969cfb306f6738032730d.js" integrity="sha512-6bKDPShiPRjAcdeO8T6cedaVEi0pavPbzue/G/ZRiwVlurWZOSZ/vI9fr2lhk8IPXK7z51AZac&#43;zBvZzgDJzDQ=="
  onload="renderMathInElement(document.body);"></script>








































































































































  
  



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Gangi&rsquo;s</a>
            

        </nav>
        <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">

            
            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="About">
        About
    </p>
</a>



            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Posts">
        Posts
    </p>
</a>



            
            
  <a href="/projects/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Projects">
        Projects
    </p>
</a>



            
            
  <a href="/resume/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Resume">
        Resume
    </p>
</a>



            
            
  <a href="/music/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Music">
        Music
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class=" flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="About">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Posts">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/projects/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Projects">
            Projects
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/resume/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Resume">
            Resume
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/music/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Music">
            Music
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  
 
  
   
  
 



<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/img/banner.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >Gangi&#39;s</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/pfsense/"
      >Install and config: Pfsense</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Install and config: Pfsense
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  







  









  





<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-10-31T20:28:53&#43;07:00">31 October 2024</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">29 mins</span><span class="px-2 text-primary-500">&middot;</span>


  
    
  
  

<span class="mb-[2px]">
  <a
    href="#/posts/Pfsense/index.md"
    class="text-lg hover:text-primary-500"
    rel="noopener noreferrer"
    target="_blank"
    title="Edit content"
    ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>
  </span>

</span></a
  >
</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/document/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Document
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/firewall/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Firewall
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/devops/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Devops
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/visual/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Visual
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      

      

      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#table-of-contents">Table of contents</a>
      <ul>
        <li><a href="#what-is-pfsense-">What is Pfsense ?</a></li>
        <li><a href="#features-in-pfsense">Features in pfsense</a></li>
        <li><a href="#setup-firewall-outscope">Setup firewall (Outscope)</a>
          <ul>
            <li><a href="#initial-setup">Initial setup</a></li>
            <li><a href="#configure-lan-interface">Configure LAN Interface</a></li>
            <li><a href="#change-the-admin-password">Change the Admin password</a></li>
            <li><a href="#save-parameters">Save parameters</a></li>
            <li><a href="#configure-interface">Configure Interface</a></li>
            <li><a href="#configure-rule-and-natport-forward">Configure Rule and NAT(port-forward)</a></li>
          </ul>
        </li>
        <li><a href="#setup-firewall-inscope-non-cde">Setup firewall (Inscope Non CDE)</a></li>
        <li><a href="#build-vpn">Build VPN</a>
          <ul>
            <li><a href="#setup-vpn-client-to-site">Setup VPN Client to Site</a></li>
            <li><a href="#setup-vpn-site-to-site">Setup VPN Site to site</a></li>
          </ul>
        </li>
        <li><a href="#build-vpn-route-base-using-ospf">Build VPN Route Base (Using OSPF)</a>
          <ul>
            <li><a href="#routed-ipsec-vti">Routed IPsec (VTI)</a></li>
            <li><a href="#step-1-configure-ipsec-tunnel-on-pfsense">Step 1: Configure IPsec Tunnel on pfSense</a></li>
            <li><a href="#step-2-configure-phase-2-child-sa-for-vti">Step 2: Configure Phase 2 (Child SA) for VTI</a></li>
            <li><a href="#create-the-vti-interface">Create the VTI Interface</a></li>
            <li><a href="#step-4-firewall-rules-for-the-vti-interface">Step 4: Firewall Rules for the VTI Interface</a></li>
            <li><a href="#testing-the-vti-tunnel">Testing the VTI Tunnel</a></li>
            <li><a href="#step-5-setup-for-ospf-on-pfsense-with-vti">Step 5: Setup for OSPF on pfSense with VTI</a></li>
          </ul>
        </li>
        <li><a href="#build-vpn-with-gre-tunnel">Build VPN With GRE-TUNNEL</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#table-of-contents">Table of contents</a>
      <ul>
        <li><a href="#what-is-pfsense-">What is Pfsense ?</a></li>
        <li><a href="#features-in-pfsense">Features in pfsense</a></li>
        <li><a href="#setup-firewall-outscope">Setup firewall (Outscope)</a>
          <ul>
            <li><a href="#initial-setup">Initial setup</a></li>
            <li><a href="#configure-lan-interface">Configure LAN Interface</a></li>
            <li><a href="#change-the-admin-password">Change the Admin password</a></li>
            <li><a href="#save-parameters">Save parameters</a></li>
            <li><a href="#configure-interface">Configure Interface</a></li>
            <li><a href="#configure-rule-and-natport-forward">Configure Rule and NAT(port-forward)</a></li>
          </ul>
        </li>
        <li><a href="#setup-firewall-inscope-non-cde">Setup firewall (Inscope Non CDE)</a></li>
        <li><a href="#build-vpn">Build VPN</a>
          <ul>
            <li><a href="#setup-vpn-client-to-site">Setup VPN Client to Site</a></li>
            <li><a href="#setup-vpn-site-to-site">Setup VPN Site to site</a></li>
          </ul>
        </li>
        <li><a href="#build-vpn-route-base-using-ospf">Build VPN Route Base (Using OSPF)</a>
          <ul>
            <li><a href="#routed-ipsec-vti">Routed IPsec (VTI)</a></li>
            <li><a href="#step-1-configure-ipsec-tunnel-on-pfsense">Step 1: Configure IPsec Tunnel on pfSense</a></li>
            <li><a href="#step-2-configure-phase-2-child-sa-for-vti">Step 2: Configure Phase 2 (Child SA) for VTI</a></li>
            <li><a href="#create-the-vti-interface">Create the VTI Interface</a></li>
            <li><a href="#step-4-firewall-rules-for-the-vti-interface">Step 4: Firewall Rules for the VTI Interface</a></li>
            <li><a href="#testing-the-vti-tunnel">Testing the VTI Tunnel</a></li>
            <li><a href="#step-5-setup-for-ospf-on-pfsense-with-vti">Step 5: Setup for OSPF on pfSense with VTI</a></li>
          </ul>
        </li>
        <li><a href="#build-vpn-with-gre-tunnel">Build VPN With GRE-TUNNEL</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
           
            $(e).removeClass('active').siblings('ul').hide();
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
         
          $toc.find('a').parent('li').find('ul').hide();
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          



<h1 class="relative group">Pfsense, Client to Site &amp;  Site to site 
    <div id="pfsense-client-to-site---site-to-site" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#pfsense-client-to-site---site-to-site" aria-label="Anchor">#</a>
    </span>        
    
</h1>


<h2 class="relative group">Table of contents 
    <div id="table-of-contents" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#table-of-contents" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li><a href="#pfsense-client-to-site---site-to-site">Pfsense, Client to Site &amp;  Site to site</a>
<ul>
<li><a href="#table-of-contents">Table of contents</a>
<ul>
<li><a href="#what-is-pfsense-">What is Pfsense ?</a></li>
<li><a href="#features-in-pfsense">Features in pfsense</a></li>
<li><a href="#setup-firewall-outscope">Setup firewall (Outscope)</a>
<ul>
<li><a href="#initial-setup">Initial setup</a>
<ul>
<li><a href="#general-information">General Information</a></li>
<li><a href="#time-server-configuration">Time Server Configuration</a></li>
<li><a href="#wan-interface-configuration">WAN Interface Configuration</a></li>
</ul>
</li>
<li><a href="#configure-lan-interface">Configure LAN Interface</a></li>
<li><a href="#change-the-admin-password">Change the Admin password</a></li>
<li><a href="#save-parameters">Save parameters</a></li>
<li><a href="#configure-interface">Configure Interface</a></li>
<li><a href="#configure-rule-and-natport-forward">Configure Rule and NAT(port-forward)</a>
<ul>
<li><a href="#i-rule-wan-interface">I. Rule WAN interface</a></li>
<li><a href="#ii-rule-lan-interface">II. Rule LAN interface</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#setup-firewall-inscope-non-cde">Setup firewall (Inscope Non CDE)</a></li>
<li><a href="#build-vpn">Build VPN</a>
<ul>
<li><a href="#setup-vpn-client-to-site">Setup VPN Client to Site</a>
<ul>
<li><a href="#step-1-configure-wan-interface">Step 1: Configure WAN interface</a></li>
<li><a href="#step-2-create-a-virtual-ip">Step 2: Create a Virtual IP</a></li>
<li><a href="#step-3-create-certificate-authority--ca">Step 3: Create Certificate Authority – CA</a></li>
<li><a href="#step-4-create-server-certificate">Step 4: Create Server Certificate</a></li>
<li><a href="#step-5-create-a-vpn--openvpn-server">Step 5: Create a VPN – OpenVPN Server</a></li>
<li><a href="#step-6-create-a-vpn--openvpn-client">Step 6: Create a VPN – OpenVPN Client</a></li>
<li><a href="#step-7-install-the-openvpn-client-export-utility-a-tool-that-helps-export-the-vpn-client">Step 7: Install the OpenVPN Client Export Utility, a tool that helps export the VPN client</a></li>
<li><a href="#step-8--create-user-openvpn">Step 8 : Create user OpenVPN</a></li>
<li><a href="#step-9-configure-access-permissions-in-the-vpn">Step 9: Configure access permissions in the VPN</a></li>
<li><a href="#step-10-configure-access-to-the-vpn">Step 10: Configure access to the VPN</a></li>
<li><a href="#step-11-configure-nat-outbound">Step 11: Configure NAT outbound</a></li>
<li><a href="#step-12-export-the-vpn-client-installation-package">Step 12: Export the VPN Client installation package</a></li>
<li><a href="#step-13-test-the-openvpn-connection">Step 13: Test the OpenVPN connection</a></li>
</ul>
</li>
<li><a href="#setup-vpn-site-to-site">Setup VPN Site to site</a>
<ul>
<li><a href="#setup-network-on-cmc-cloud-site-hcm">Setup Network on CMC-Cloud Site HCM</a></li>
<li><a href="#configure-interface-outscope-noncde-cde-site-hcm">Configure Interface OutScope, NonCDE, CDE Site HCM</a></li>
<li><a href="#configure-the-ipsec-tunnel-site-hcm">Configure the IPSec tunnel Site HCM</a></li>
<li><a href="#configure-firewall-for-local-connections-site-hcm">Configure Firewall for local connections Site HCM</a></li>
<li><a href="#config-route-table-in-cmc-cloud-on-site-hcm">Config Route table in CMC-Cloud on Site HCM</a></li>
<li><a href="#setup-network-on-cmc-cloud-site-hn">Setup Network on CMC-Cloud Site HN</a></li>
<li><a href="#configure-interface-outscope-noncde-cde-site-hn">Configure Interface OutScope, NonCDE, CDE Site HN</a></li>
<li><a href="#configure-the-ipsec-tunnel-site-hn">Configure the IPSec tunnel Site HN</a></li>
<li><a href="#configure-firewall-for-local-connections-site-hn">Configure Firewall for local connections Site HN</a></li>
<li><a href="#config-route-table-in-cmc-cloud-on-site-hn">Config Route table in CMC-Cloud on Site HN</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#build-vpn-route-base-using-ospf">Build VPN Route Base (Using OSPF)</a>
<ul>
<li><a href="#routed-ipsec-vti">Routed IPsec (VTI)</a>
<ul>
<li><a href="#hanoi---khanhs-zone-v%c3%b9ng-1---phan">HANOI - Khanh&rsquo;s zone (Vùng 1) - PHAN</a></li>
<li><a href="#hcm---khanhs-zone-v%c3%b9ng-2---giang">HCM - Khanh&rsquo;s zone (Vùng 2) - GIANG</a></li>
<li><a href="#hcm---trams-zone-v%c3%b9ng-3---tri">HCM - Tram&rsquo;s zone (Vùng 3) - TRI</a></li>
</ul>
</li>
<li><a href="#step-1-configure-ipsec-tunnel-on-pfsense">Step 1: Configure IPsec Tunnel on pfSense</a></li>
<li><a href="#step-2-configure-phase-2-child-sa-for-vti">Step 2: Configure Phase 2 (Child SA) for VTI</a></li>
<li><a href="#create-the-vti-interface">Create the VTI Interface</a></li>
<li><a href="#step-4-firewall-rules-for-the-vti-interface">Step 4: Firewall Rules for the VTI Interface</a></li>
<li><a href="#testing-the-vti-tunnel">Testing the VTI Tunnel</a></li>
<li><a href="#step-5-setup-for-ospf-on-pfsense-with-vti">Step 5: Setup for OSPF on pfSense with VTI</a>
<ul>
<li><a href="#i-install-the-frr-package-on-pfsense">I. Install the FRR Package on pfSense</a></li>
<li><a href="#ii-configure-frr-global-settings">II. Configure FRR Global Settings</a></li>
<li><a href="#iii-configure-ospf-in-frr">III. Configure OSPF in FRR</a></li>
<li><a href="#iv-configure-static-routing-in-pfsense">IV. Configure Static Routing in Pfsense</a></li>
<li><a href="#v-check-status-ospf-in-frr">V. Check status OSPF in FRR</a></li>
<li><a href="#v-check-ping">V. Check ping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#build-vpn-with-gre-tunnel">Build VPN With GRE-TUNNEL</a></li>
</ul>
</li>
</ul>
</li>
</ul>


<h3 class="relative group">What is Pfsense ? 
    <div id="what-is-pfsense-" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#what-is-pfsense-" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p><strong><code>Pfsense</code></strong>: is an application that functions as a network firewall router and is free based on <code>FreeBSD</code>. Pfsense is configured through a web GUI interface for easy management and customization. It supports filtering based on source address, destination, source port, destination port, supports routing, and can operate in bridge or transparent mode.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfsense.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Moreover, If using pfsense as a gateway, we can clearly see the support for NAT and port forwarding on pfsense as well as performing load balancing or failover on the network paths.</p>


<h3 class="relative group">Features in pfsense 
    <div id="features-in-pfsense" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#features-in-pfsense" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ol>
<li>
<p><em><code>Aliases</code></em>: In pfsense, the firewall cannot have a rule consisting of multiple IP groups or a port group. Therefore, it is necessary to group IP, Port, or URL into one alias. An alias allows to substitute one host, one network range, multiple separate IPs, or a group of ports, URLs&hellip; Aliases help save time if used correctly.</p>
</li>
<li>
<p><em><code>NAT</code></em>: Pfsense supports Static NAT in the form of NAT 1:1. The condition to perform NAT 1:1 is to have a public IP. When performing NAT 1:1, the Private IP being NAT-ed will always go out with the corresponding Public IP, and the ports will also correspond on the Public IP.</p>
</li>
<li>
<p><em><code>Powerful firewall</code></em>: PFsense provides a strong firewall with the ability to filter packets based on IP address, port, protocol, application,&hellip; It also supports complex and flexible firewall rules. Rules must be created to manage the internal network.</p>
</li>
<li>
<p><em><code>Analyze and manage traffic</code></em>: PFsense provides network traffic analysis tools such as NetFlow and many other plugins to help you understand and manage Internet usage in your network.</p>
</li>
<li>
<p><em><code>VPN (Virtual Private Network)</code></em>: PFsense supports multiple VPN protocols such as <em><code>IPsec</code></em>, <em><code>OpenVPN</code></em>, <em><code>L2TP</code></em>, and <em><code>PPTP</code></em>, allowing secure VPN connections to be established between locations or remote users.</p>
</li>
<li>
<p><em><code>Proxy Server</code></em>: PFsense can act as a <code>proxy server</code>, allowing to control and filter web content, providing security and managing Internet traffic.</p>
</li>
<li>
<p><em><code>Load balancing and failover</code></em>: PFsense supports load balancing across multiple Internet connections to optimize network performance and availability. It also features redundancy to ensure service continuity.</p>
</li>
<li>
<p><em><code>Manage access control lists (ACL)</code></em>: By using access control lists, you can control the Internet access rights of users in the network, from blocking access to specific websites to managing access time.</p>
</li>
<li>
<p><em><code>Security</code></em>: PFsense supports many security features such as <code>IDS/IPS</code> (Intrusion Detection/Prevention System), <code>DPI</code> (Deep Packet Inspection), <code>DDoS</code> protection, to protect the network from various threats.</p>
</li>
<li>
<p><em><code>Managing DHCP and DNS:</code></em>: PFsense also provides DHCP and DNS management services to automatically assign IP addresses and manage domains within the network.</p>
</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs.jpg"
        alt="pfsense"
      />
      
    </figure>
</p>


<h3 class="relative group">Setup firewall (Outscope) 
    <div id="setup-firewall-outscope" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#setup-firewall-outscope" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>The pfSense solution is an open-source firewall project originating from the Monowall firewall project from many years ago. According to pfsense.org, thousands of enterprises use pfSense. Essentially, pfSense will include a full-featured firewall/L3 routing suite with many other features such as proxy server, IDS/IPS, high availability, certificate management, and centralized VPN.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/fo.svg"
        alt="architecture"
      />
      
    </figure>
</p>


<h4 class="relative group">Initial setup 
    <div id="initial-setup" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#initial-setup" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<blockquote>
<p>[!CAUTION]
<em><strong>Error login HTTP_REFERER</strong></em>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_error.png"
        alt="pfsense"
      />
      
    </figure>
</p></blockquote>
<p>Access <strong>terminal console</strong> of <strong>pfsense -&gt; select number <code>8</code></strong>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_fix.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">pfSsh.php playback disablereferercheck
</span></span></code></pre></div><blockquote>
<p>[!NOTE]
<em><strong>ERR_CONNECTION_TIMED_OUT</strong></em></p></blockquote>
<ul>
<li>
<p>Assignment Interface in pfSense:</p>
<p>After configuring VLANs, pfSense will prompt you to assign the WAN interface. Typically, pfSense will display a list of network interfaces connected to it, such as vtnet0 and vtnet1. These are common virtual network interface names in cloud environments.</p>
<ul>
<li>
<p><code>Cloud Environment Consideration:</code></p>
<ul>
<li>In a cloud environment, if you do not have a VPN setup, pfSense will require a public IP address on the WAN interface to allow access to the User Interface (UI). This is crucial because, without VPN, the only way to manage pfSense remotely is through this public IP.</li>
</ul>
</li>
<li>
<p><code>WAN Configuration Before LAN:</code></p>
<ul>
<li>It is essential to configure WAN access rules before setting up the LAN interface, especially for ports 443 (HTTPS) and 80 (HTTP). <code>This is because, once the LAN interface is assigned, pfSense’s &quot;Default Rule&quot; will automatically shift from the WAN to the LAN interface</code>.</li>
<li>This behavior is part of pfSense’s security mechanism, where the default access rules will prioritize the LAN interface once it&rsquo;s assigned.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>If you assign the LAN interface before configuring the necessary WAN rules, you might lose access to pfSense through the WAN interface. This happens because the default allow rules will then apply to the LAN, <code>leaving the WAN interface without the required access permissions</code>.</p>
<p>When accessing the Web UI interface, pfSense will automatically display the Setup Wizard page to set up the main parameters for the system.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfsense-web-ui.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Click <strong><code>Next</code></strong> to continue</p>


<h5 class="relative group">General Information 
    <div id="general-information" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#general-information" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfsense-web-ui-1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Set up <code>Hostname</code>, <code>Domain</code>, <code>DNS Server</code>, then click <code>Next</code></p>
<ul>
<li>
<p>Hostname: keep pfSense unchanged, you can change later.</p>
</li>
<li>
<p>Domain: keep the default home.arpa, you can change later.</p>
</li>
<li>
<p>Primary &amp; Secondary DNS Server: Enter Cloudflare DNS (1.1.1.1 and 1.0.0.1) or Google DNS (8.8.8.8 and 8.8.4.4), or leave it blank.</p>
</li>
<li>
<p>Override DNS: Select this if you want to use the DNS provided by the DHCP Server sent to the WAN port.</p>
</li>
</ul>


<h5 class="relative group">Time Server Configuration 
    <div id="time-server-configuration" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#time-server-configuration" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfsense-web-ui-2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Adjust time zone and Time Server. I use time server <code>1.vn.pool.ntp.org.</code></p>


<h5 class="relative group">WAN Interface Configuration 
    <div id="wan-interface-configuration" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#wan-interface-configuration" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>Configure the WAN Interface and LAN Interface according to the virtual network diagram designed in architecture.</p>
<ol>
<li>
<p><strong>Step 1:</strong></p>
<ul>
<li>Setup IP address of WAN and LAN in portal CMC-Cloud</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<ul>
<li>Setup security group in portal CMC-Cloud</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><strong>Step 2:</strong></p>
<ul>
<li>Set the WAN Interface Type to Static with the following IP parameters:</li>
</ul>
</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/sub_net.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><strong>IP Address:</strong> <code>172.24.48.8</code></p>
<p><strong>Subnet Mask:</strong> <code>24</code></p>
<p><strong>Upstream Gateway:</strong> <code>172.24.48.1</code> (IP of the Mikrotik Router)</p>
<p>In a real-world scenario, if you are using pfSense to connect to the ISP&rsquo;s optical modem, you will need to change the WAN Interface Type to PPPoE and enter the provided Username/Password for connection authentication.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Set the <code>WAN</code> Interface to <code>DHCP</code> IP</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Uncheck the option <code>Block RFC1918 Private Networks</code> and <code>Block bogon networks</code></p>
<p>Block RFC1918 Private Networks: This option means that pfSense will block all access to the WAN port from internal IP ranges (<code>10/8, 172.16/12, 192.168/16</code>).</p>
<p>Since I&rsquo;m using pfSense in a virtual network on CMC-Cloud, where all connections to the WAN port are internal IPs (<code>172.24.48.0/24</code>), it is necessary to uncheck Block RFC1918 Private Networks to allow the Host to access the pfSense management page.</p>


<h4 class="relative group">Configure LAN Interface 
    <div id="configure-lan-interface" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-lan-interface" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Change LAN IP Address to <code>dhcp</code> and Subnet Mask <code>32</code></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_3.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h4 class="relative group">Change the Admin password 
    <div id="change-the-admin-password" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#change-the-admin-password" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_4.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Enter <code>new password</code> for Admin account</p>


<h4 class="relative group">Save parameters 
    <div id="save-parameters" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#save-parameters" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_5.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Click <code>Reload</code> to let pfSense save the parameters and restart the service.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_6.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Click <code>Finish</code> to complete</p>
<p><strong><code>Result:</code></strong> Dashboard of pfsense</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_7.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h4 class="relative group">Configure Interface 
    <div id="configure-interface" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-interface" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Add interface <code>vtnet1</code></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/pfs_oos_8.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Config <code>WAN</code> interface</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/wan-oos.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/wan-oos-1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Config <code>LAN</code> interface</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/lan-oos.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/lan-oos-1.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h4 class="relative group">Configure Rule and NAT(port-forward) 
    <div id="configure-rule-and-natport-forward" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-rule-and-natport-forward" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<blockquote>
<p><strong>Rule</strong></p></blockquote>


<h5 class="relative group">I. Rule WAN interface 
    <div id="i-rule-wan-interface" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#i-rule-wan-interface" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/rule-wan.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<ul>
<li>
<p>Allow Port access UI</p>
<blockquote>
<p>[!NOTE]
If the service runs on two ports, <code>80 (HTTP)</code> and <code>443 (HTTPS)</code>, it should be configured to access the public IP address via a different port to avoid conflicts when configuring port forwarding.</p></blockquote>
<ul>
<li>Go to: System -&gt; Advanced -&gt; Admin Access -&gt; webConfigurator -&gt; TCP Port: &lsquo;Port different: 80 and 443&rsquo; -&gt; Save -&gt; Apply changes and wait 20 seconds for automatic redirection. (Remember to create an Allow Rule for WAN Access on the configured port).</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/rule-wan-1.png"
        alt="pfsense"
      />
      
    </figure>
 
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/rule-wan-2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Virtual IP port-forward to 80 and 443</p>
<p>To set up port forwarding to ports 80 and 443 using a Virtual IP, you need to configure the following steps:</p>
<ul>
<li>Step 1. Create a Virtual IP on CMC-lor:
<ul>
<li>
<p>Go to Dashboard CMC-Cloud -&gt;<code>Virtual Private Cloud</code> -&gt; <code>Subnets</code> -&gt; <code>subnet-outscope-bvb</code> -&gt; <code>IP address</code>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vip.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Select button <code>Assign Virtual IP address</code> -&gt; <code>Automatic</code> -&gt; <code>OK</code>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vip_1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Continue select <code>Actions</code> -&gt; <code>Bind to Server</code> -&gt; <code>Select Server</code> -&gt; <code>Select Port</code> -&gt; <code>Bind Server</code>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vip_2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vip_3.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<h5 class="relative group">II. Rule LAN interface 
    <div id="ii-rule-lan-interface" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ii-rule-lan-interface" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/rule-lan.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<blockquote>
<p><strong>NAT</strong></p></blockquote>
<ol>
<li>NAT Port-forward</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/nat-pf.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<ul>
<li>Go to Port Forwarding Settings:
<ul>
<li>Navigate to Firewall -&gt; NAT -&gt; Port Forward.</li>
<li>Click Add to create a new NAT rule for port forwarding.</li>
</ul>
</li>
</ul>
<p>Configure port forwarding from the <code>WAN</code> interface to the internal <code>NAT IP</code> (<code>172.24.65.98</code>) on port <code>80</code> (<code>HTTP</code>)</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/nat-pf1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>Configure port forwarding from the <code>WAN</code> interface to the internal <code>NAT IP</code> (172.24.65.98) on port <code>443</code> (<code>HTTPS</code>)</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/nat-pf2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<ol>
<li>NAT Outbound</li>
</ol>
<ul>
<li>Select <code>Hybrid Outbound NAT rule generation. (Automatic Outbound NAT + rules below)</code></li>
<li>Add Mapping LAN address to subnet 172.24.64.0/20 (outscope)</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Outbound.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Outbound1.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h3 class="relative group">Setup firewall (Inscope Non CDE) 
    <div id="setup-firewall-inscope-non-cde" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#setup-firewall-inscope-non-cde" aria-label="Anchor">#</a>
    </span>        
    
</h3>


<h3 class="relative group">Build VPN 
    <div id="build-vpn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#build-vpn" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p><code>OpenVPN</code> is a virtual private network (VPN) system that implements techniques to create secure point-to-point or site-to-site connections. It allows parties to authenticate each other using <code>pre-shared keys</code>, <code>certificates</code>, or <code>usernames/passwords</code>. When used in a multi client-server configuration, it enables the server to issue an authentication certificate to each client. It uses the OpenSSL encryption library as well as the widely-used <em>TLS protocol</em>, with many control and security features.</p>
<blockquote>
<p>[!NOTE]
<em><strong>The pfSense firewall is installed and working with interfaces including WAN and LAN</strong></em></p></blockquote>


<h4 class="relative group">Setup VPN Client to Site 
    <div id="setup-vpn-client-to-site" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#setup-vpn-client-to-site" aria-label="Anchor">#</a>
    </span>        
    
</h4>


<h5 class="relative group">Step 1: Configure WAN interface 
    <div id="step-1-configure-wan-interface" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-1-configure-wan-interface" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>Setup IP address of WAN in portal CMC-Cloud</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<ul>
<li>Setup security group in portal CMC-Cloud</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts1.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h5 class="relative group">Step 2: Create a Virtual IP 
    <div id="step-2-create-a-virtual-ip" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-2-create-a-virtual-ip" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>Navigate to Firewall -&gt; <code>Virtual IPs</code>.</li>
<li>Click <code>Add</code> to create a new Virtual IP.</li>
<li>Set the <code>Type</code> to <code>IP Alias</code>.</li>
<li>Assign the <code>Virtual IP Address</code> (42.96.47.201) that you want to use.</li>
<li>Set the Interface to <code>WAN</code> or whichever interface you want the Virtual IP to be associated with.</li>
<li>Save and apply the changes.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts2.png"
        alt="pfsense"
      />
      
    </figure>


    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts3.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h5 class="relative group">Step 3: Create Certificate Authority – CA 
    <div id="step-3-create-certificate-authority--ca" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-3-create-certificate-authority--ca" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Go to the menu <code>System &gt; Cert. Manager</code>.</p>
</li>
<li>
<p>Click button <code>Add</code> to create a new CA.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_ca.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Enter an identifying name for the CA.</p>
</li>
<li>
<p>Set the <code>method</code> to <strong>Create an internal Certificate Authority</strong>.</p>
</li>
<li>
<p>Select <strong>Key Type</strong>. (RSA, ECDSA..)</p>
</li>
<li>
<p>Set the length of the key <strong>Key length (2048, 4096, …)</strong>.</p>
</li>
<li>
<p>Select <strong>Digest Algorithm encryption algorithm (sha256, sha512, …)</strong>.</p>
</li>
<li>
<p>Set a common name <strong>Common Name (internal-ca, own-ca, &hellip;)</strong>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_ca1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Save to complete CA</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_ca2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h5 class="relative group">Step 4: Create Server Certificate 
    <div id="step-4-create-server-certificate" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-4-create-server-certificate" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Go to the <code>System &gt; Cert. Manager menu</code>.</p>
</li>
<li>
<p>Access the <code>Certificates</code> tab in the submenu.</p>
</li>
<li>
<p>Select <code>Add/Sign</code> at the bottom right.</p>
</li>
<li>
<p>Set the <code>Method</code> to <code>Create an internal Certificate Authority</code>.</p>
</li>
<li>
<p>Enter a Descriptive name.</p>
</li>
<li>
<p>Set the <code>Key length</code> and <code>Digest Algorithm</code> the same as the previously created <code>CA</code>.</p>
</li>
<li>
<p>Adjust the <code>Lifetime</code> to 3650 days or customize it, not exceeding 398 days.</p>
</li>
<li>
<p>Set the Common Name.</p>
</li>
<li>
<p>Set the <code>Certificate Type</code> to Server <code>Certificate</code>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_ca3.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Save to complete <code>Server Certificate</code>.</p>
</li>
</ul>


<h5 class="relative group">Step 5: Create a VPN – OpenVPN Server 
    <div id="step-5-create-a-vpn--openvpn-server" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-5-create-a-vpn--openvpn-server" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Select the <code>VPN &gt; OpenVPN</code>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Select <code>Add</code>.</p>
<ul>
<li>General Information:
<ol>
<li>Set <strong>Server mode</strong> to <strong>Remote Access (SSL/TLS + User Auth)</strong>.</li>
<li><strong>Local port</strong>, select the connection port, default port <strong>1194</strong>.</li>
<li>Enter a <strong>description</strong>.</li>
</ol>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<ul>
<li>
<p><code>Cryptographic</code> Settings:</p>
<ol>
<li>Select Use <strong>TLS Key</strong> and automatically enable <strong>Automatically generate a TLS Key</strong>.</li>
<li>In <strong>Peer Certificate Authority</strong>, select the CA that was previously created.</li>
<li>Select the <strong>Server Certificate</strong> created.</li>
<li>Choose 2048 for <strong>DH Parameter Length</strong>.</li>
<li>Set <strong>Auth digest algorithm</strong> to RSA-SHA256 (256-bit).</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn2.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn3.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>VPN Tunnel</code> Settings:</p>
<ol>
<li>Create a subnet in <strong>IPv4 Tunnel Network</strong> as <code>10.20.10.0/24</code>.</li>
<li>Leave <strong>IPv6 Tunnel Network</strong> blank.</li>
<li>Enable <strong>Redirect IPv4 Gateway</strong>.</li>
<li>Specify the <code>maximum number(20)</code> of clients allowed to concurrently connect to this server.</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn4.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Client Settings</code> and <code>Ping settings</code></p>
<p>Keep default setting</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn5.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Advanced Client Settings</code> and <code>Advanced Configuration</code>:</p>
<ol>
<li>Enable DNS Server and add IP DNS Server <code>10.20.10.1</code>.</li>
<li>Choose IPv4 Only in Gateway creation; select Both if using IPv4 and IPv6.</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn6.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>
</li>
<li>
<p>Press <code>Save</code> to update the configuration.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn7.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h5 class="relative group">Step 6: Create a VPN – OpenVPN Client 
    <div id="step-6-create-a-vpn--openvpn-client" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-6-create-a-vpn--openvpn-client" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>Navigate to <code>VPN &gt; OpenVPN &gt; Clients</code>.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<ul>
<li>
<p>Click the <code>Add</code> button.</p>
<ul>
<li>
<p>General Information:</p>
<ol>
<li>Enter a <strong>description</strong>.</li>
<li><strong>Disabled</strong>: Leave this unchecked or your client connection will be disabled.</li>
<li>Set <strong>Server mode</strong> to <strong>Peer to Peer (SSL/TLS)</strong>.</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Endpoint Configuration</code> Setting:</p>
<ol>
<li><strong>Protocol</strong>:Have 2 option UDP and TCP. And we used <em>TCP only on IPv4</em>.</li>
<li>Set <strong>Interface</strong>: <code>42.96.47.201((VIP))</code>. The virtual IP (VIP) was created previously.</li>
<li><strong>Local port</strong>: Leave blank unless specified by your VPN provider</li>
<li><strong>Server host or address</strong>: The IP address(<em><code>42.96.47.201</code></em>) or hostname of the VPN server to which you will connect.</li>
<li><strong>Server port</strong>: The port(<em><code>1194</code></em>) over which the VPN connection will be made.</li>
<li><strong>Proxy host or address</strong>: Leave blank</li>
<li><strong>Proxy port</strong>: Leave blank</li>
<li><strong>Proxy Authentication</strong>: none

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c2.png"
        alt="pfsense"
      />
      
    </figure>
</li>
</ol>
</li>
<li>
<p><code>User Authentication</code> Settings</p>
<ol>
<li>Username: Your username, client identifier, account number, etc.</li>
<li>Password: Your password (if required)</li>
<li>Automatic Retry: Leave unchecked so that your client will attempt to reconnect when authentication fails.</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c3.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Cryptographic</code> Settings</p>
<ol>
<li>Select Use <strong>TLS Key</strong> and automatically enable <strong>Automatically generate a TLS Key</strong>.</li>
<li>In <strong>Peer Certificate Authority</strong>, select the CA that was previously created.</li>
<li><strong>Client Certificate</strong>: Leave this set to None.</li>
<li>Set <strong>Auth digest algorithm</strong> to RSA-SHA256 (256-bit).</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c4.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c5.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>VPN Tunnel</code> Settings: Keep default in Tunnel Setting section.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c6.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Ping settings</code></p>
<p>Keep default setting</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c7.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Advanced Configuration</code>:</p>
<ul>
<li>Choose IPv4 Only in <code>Gateway creation</code>; select Both if using IPv4 and IPv6.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c8.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>
</li>
<li>
<p>Press <code>Save</code> to update the configuration.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_c9.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h5 class="relative group">Step 7: Install the OpenVPN Client Export Utility, a tool that helps export the VPN client 
    <div id="step-7-install-the-openvpn-client-export-utility-a-tool-that-helps-export-the-vpn-client" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-7-install-the-openvpn-client-export-utility-a-tool-that-helps-export-the-vpn-client" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Go to <code>System &gt; Package Manager</code>.</p>
</li>
<li>
<p>Select <strong>Available Packages</strong> in the submenu.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_pkt.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Find the <code>openvpn-client-export utility</code> and select <strong>install</strong> to install it.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_pkt1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Press <strong>confirm</strong> to install.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_pkt2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Once installation is complete, <strong>Success</strong> will be displayed in the <strong>Package Installer</strong> interface.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_pkt3.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_pkt4.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h5 class="relative group">Step 8 : Create user OpenVPN 
    <div id="step-8--create-user-openvpn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-8--create-user-openvpn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Go to the menu <strong>System &gt; User Manager</strong>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_user.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Select the <strong>Add</strong> button and enter a <strong>Username</strong> and <strong>Password</strong> for your user.</p>
</li>
<li>
<p>Press <strong>Save</strong>, and the <strong>OpenVPN user</strong> will be successfully created and then redirected to the initial interface.</p>
</li>
<li>
<p>Configure the authentication method as certificate and password.</p>
</li>
<li>
<p>Select <strong>Add</strong> -&gt; <strong>User Certificate</strong> and enter additional information.</p>
</li>
<li>
<p>Set the method (<strong>Method -&gt; Create an internal Certificate</strong>).</p>
</li>
<li>
<p>Choose <strong>Key length, Type, and Digest Algorithm</strong> to match the previously created <strong>CA</strong>.</p>
</li>
<li>
<p>Set the expiration time <strong>Lifetime to 3650 days</strong>.</p>
</li>
<li>
<p>Ensure that <strong>Certificate Type</strong> is selected as the user certificate just created <strong>(User Certificate)</strong>.</p>
</li>
<li>
<p><strong>Save</strong> to complete linking the user certificate with the OpenVPN user <strong>(User Certificate – OpenVPN user)</strong>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_user1.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_user2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Press <strong>Save</strong> to complete the setup of creating the user account for OpenVPN.</p>
</li>
</ul>


<h5 class="relative group">Step 9: Configure access permissions in the VPN 
    <div id="step-9-configure-access-permissions-in-the-vpn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-9-configure-access-permissions-in-the-vpn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Go to the <code>Firewall &gt; Rules</code> menu.</p>
</li>
<li>
<p>Select <strong>OpenVPN</strong>.</p>
</li>
<li>
<p>Select the first <strong>Add</strong> to add a new rule.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_rule_vpnn.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><strong>Interface</strong>: OpenVPN</p>
</li>
<li>
<p><strong>Address Family</strong>, choose <strong>IPv4</strong> only.</p>
</li>
<li>
<p><strong>Protocol</strong>, select <strong>TCP</strong>.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_rule_vpn.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Source</code>, choose <strong>any</strong>.</p>
</li>
<li>
<p>Enter a <strong>description</strong>, press Save, and Apply Changes to save the configuration.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_rule_vpn1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h5 class="relative group">Step 10: Configure access to the VPN 
    <div id="step-10-configure-access-to-the-vpn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-10-configure-access-to-the-vpn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Go to the <code>Firewall &gt; Rules</code> menu.</p>
</li>
<li>
<p>Select the <strong>WAN</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add</strong> to add a new rule.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_rule_wan.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Set <strong>Address Family</strong> to <strong>IPv4</strong>.</p>
</li>
<li>
<p><strong>Protocol</strong>, choose <strong>TCP</strong>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_rule_wan1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Set <strong>Source</strong> to <strong>any</strong>.</p>
</li>
<li>
<p><code>Destination Port Range</code>, enter the OpenVPN port configured earlier, which is <strong><code>1194</code></strong>.</p>
</li>
<li>
<p>Enter a <strong>description</strong>, press <strong>Save</strong>, and Apply Changes to save the configuration.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_rule_wan2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h5 class="relative group">Step 11: Configure NAT outbound 
    <div id="step-11-configure-nat-outbound" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-11-configure-nat-outbound" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>Navigate to <code>Firewall &gt; NAT &gt; Outbound</code>.
<ul>
<li>
<p>Outbound NAT Mode: <em><strong>Hybrid Outbound NAT rule generation.
(Automatic Outbound NAT + rules below)</strong></em> and then click <strong>Save</strong> and Apply Changes NAT rules.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_nat.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Mappings Configure</p>
<ul>
<li>Click the green <strong>Add</strong> button with a downward pointing arrow, to create a new NAT rule.</li>
<li>Set the <strong>Interface</strong> field to the VPN interface we created earlier.</li>
<li>Set the <strong>Address Family</strong> to either IPv4 or IPv4+IPv6 if your VPN provider explicitly supports IPv6.</li>
<li>Set the <strong>Source</strong> and <strong>Destination</strong> network with subnet address.</li>
<li>Leave all the other settings untouched. Click <strong>Save</strong> and <strong>Apply Changes</strong>.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_nat1.png"
        alt="pfsense"
      />
      
    </figure>
! <a href="Imgs/cts_nat2.png">pfsense</a></p>
</li>
</ul>
</li>
</ul>


<h5 class="relative group">Step 12: Export the VPN Client installation package 
    <div id="step-12-export-the-vpn-client-installation-package" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-12-export-the-vpn-client-installation-package" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Go to <code>VPN &gt; OpenVPN</code>.</p>
</li>
<li>
<p>Select <code>Client Export</code> in the submenu.</p>
</li>
<li>
<p>Select the correct <strong>OpenVPN</strong> server next to <strong>Remote Access Server</strong>.</p>
</li>
<li>
<p>If using <code>Dynamic DNS</code> to access the pfSense <strong>WAN</strong> network, choose <strong>Other</strong> and select <strong>Host Name Resolution</strong> (This setting allows access to the pfSense WAN network using a name instead of an IP address, ensuring no loss of access to the OpenVPN server if the ISP changes the IP or WAN network). <code>Exp: 42.96.47.201</code></p>
</li>
<li>
<p>If not using this, set <strong>Host Name Resolution</strong> to <strong>Interface IP Address</strong>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn_exp.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn_exp1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Scroll down to the user location to download the VPN Client installation file, and choose the appropriate installation file.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/cts_vpn_exp2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h5 class="relative group">Step 13: Test the OpenVPN connection 
    <div id="step-13-test-the-openvpn-connection" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-13-test-the-openvpn-connection" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ul>
<li>
<p>Run the installation file for the <strong>VPN Client</strong> that was downloaded.</p>
</li>
<li>
<p>Once successfully connected to <strong>OpenVPN</strong>,</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vpn_test.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Network information – when connected to <strong>OpenVPN</strong>.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vpn_test1.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vpn_test2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/vpn_test3.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>


<h4 class="relative group">Setup VPN Site to site 
    <div id="setup-vpn-site-to-site" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#setup-vpn-site-to-site" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<blockquote>
<p>Site HCM</p></blockquote>
<p>Start with configuring the tunnel and related settings on the firewall at Site HCM.</p>


<h5 class="relative group">Setup Network on CMC-Cloud Site HCM 
    <div id="setup-network-on-cmc-cloud-site-hcm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#setup-network-on-cmc-cloud-site-hcm" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ol>
<li>
<p>Setup IP address of <code>WAN</code> and <code>LAN</code> in portal <code>CMC-Cloud</code>:</p>
<p>Add <strong>IP private</strong> and <strong>IP public</strong>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Setup <strong>security group</strong> in portal CMC-Cloud

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc0.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc1.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Allowed address pairs</code></p>
<ul>
<li>Double click to open tab <code>Update port</code> -&gt; <strong>Allowed address pairs</strong></li>
<li>Add Security Group</li>
<li>Add <em><code>IP Address or CIDR *</code></em> -&gt; <code>Mac Address</code></li>
<li>Click Add to create a new <strong>Allowed address pairs</strong>.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc3.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc4.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc5.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/vpn_s2s_cmc6.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ol>


<h5 class="relative group">Configure Interface OutScope, NonCDE, CDE Site HCM 
    <div id="configure-interface-outscope-noncde-cde-site-hcm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-interface-outscope-noncde-cde-site-hcm" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>Let&rsquo;s start.</p>
<p>First, configure the internal LAN and the gateway interface. To do this, in the browser, go to the server IP address or domain name if any. Enter the username and password and get to the Home screen (Dashboard). In the program menu, go to the interfaces section <code>Interfaces -&gt; Assignments</code>. In our case, have 3 interfaces are already distributed - we leave it as it is. If you have several interfaces, you should select the necessary interface by mac-address and click the Add button.</p>
<p>Assign an IP address to the interface <strong>“looking”</strong> to the local network.</p>
<ul>
<li>Add interface vtnet1 (OutScope)</li>
<li>Add interface vtnet2 (NonCDE)</li>
<li>Add interface vtnet3 (CDE)</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s2.png"
        alt="pfsense"
      />
      
    </figure>


    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>In the program menu, change interface name <code>interfaces section -&gt; OutScope | NonCDE | CDE</code>. At the end of the setup, click the Save button.</p>
<p>For all servers in the local network, as the default gateway, set the IP address specified in the LAN.</p>
<ul>
<li>
<p>Assign <code>Interface &gt; OutScope</code></p>
<ul>
<li>Setting <code>General Configuration</code>
<ul>
<li>Select <strong>enable interface</strong></li>
<li>IPv4 Type: <strong>DHCP</strong></li>
</ul>
</li>
<li>DHCP Client Configuration
<ul>
<li>Keep default</li>
</ul>
</li>
<li>Reserved Networks
<ul>
<li>Untick <strong>Block private networks and loopback addresses</strong> and <strong>Block bogon networks</strong></li>
</ul>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s9.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s10.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Do the same with CDE and Non CDE

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s7.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s8.png"
        alt="pfsense"
      />
      
    </figure>


    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s5.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s6.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>
<p><code>Important!</code> If you use cloud services, then you need to unite the network nodes from the administration panel of the cloud service through <code>“Virtual Networks”</code>.</p>


<h5 class="relative group">Configure the IPSec tunnel Site HCM 
    <div id="configure-the-ipsec-tunnel-site-hcm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-the-ipsec-tunnel-site-hcm" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p><em><strong><code>Phase 1</code></strong></em></p>
<ul>
<li>Access the <code>VPN &gt; IPSEC &gt; Tunnel</code> section</li>
<li>Click on the <strong>ADD P1</strong> button
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s16.png"
        alt="pfsense"
      />
      
    </figure>
</li>
<li>In the Phase 1 configuration page of the IPsec VPN on the pfsense server, fill in the information according to the configuration similar to IPSec VPN in site HN.
<ul>
<li>
<p><code>General Information</code> Setting</p>
<ul>
<li>Enter a <strong>Description</strong></li>
<li>Uncheck <strong>Disabled</strong> this box so that the tunnel will be operational.</li>
</ul>
</li>
<li>
<p><code>IKE Endpoint Configuration</code></p>
<ul>
<li>Key Exchange version: Specifies whether to use IKEv2 or IKEv1. IKEv2 is the best practice when supported by both endpoints. If one side does not support IKEv2, use <strong>IKEv1</strong> instead.</li>
<li>Internet Protocol: <strong>IPv4</strong> in most cases unless both WANs have IPv6</li>
<li>Interface: Most likely set to <strong>WAN</strong></li>
<li>Remote Gateway: The WAN address at Site HN, in this example: <code>42.96.40.240</code>.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s17.png"
        alt="pfsense"
      />
      
    </figure>
</li>
</ul>
</li>
<li>
<p>Setup <code>Phase 1 Proposal (Authentication)</code></p>
<p>The next section controls IPsec phase 1 proposals for encryption.</p>
<ul>
<li>Authentication Method:The default, <strong>Mutual PSK</strong></li>
<li>Negotiation mode: <strong>Main</strong></li>
<li>My Identifier: <strong>My IP Address</strong></li>
<li>Peer Identifier: <strong>Any</strong></li>
<li>Pre-Shared key: generate a key (we will also need this value on our end)
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s18.png"
        alt="pfsense"
      />
      
    </figure>
</li>
</ul>
</li>
<li>
<p><code>Phase 1 Proposal (Encryption Algorithm)</code></p>
<p>Encryption Algorithm:</p>
<ul>
<li>Algorithm Select <strong>AES</strong></li>
<li>Key length use <strong>128bits</strong></li>
<li>Hash use <strong>SHA256</strong></li>
<li>DH group <strong>2</strong> (1028bit)</li>
</ul>
</li>
<li>
<p><code>Expiration and Replacement</code></p>
<ul>
<li>The Expiration and Replacement section controls the timing and method by which phase 1 will be renegotiated.
<ul>
<li>Life Time: The default <code>28800</code> is OK for this endpoint.</li>
<li>The other lifetime-related values (Rekey Time, Reauth Time, Rand Time) should be left at their defaults on this endpoint as they are automatically calculated as the correct values.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Advanced Options</code></p>
<ul>
<li>Child SA Close Action: Set this endpoint to <strong>Default</strong>. Moreover, have options <strong>Restart/Reconnect</strong> so that the phase 2 entries will be reconnected if they get disconnected.</li>
<li>Leave checked and at the default values.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s19.png"
        alt="pfsense"
      />
      
    </figure>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong> when complete</p>
</li>
</ul>
</li>
</ul>
<p><em><strong><code>Phase 2</code></strong></em></p>
<p>With the phase 1 entry complete, now a new phase 2 definition to the VPN:</p>
<ul>
<li>
<p>Click <strong>Show Phase 2 Entries</strong> to expand the phase 2 list for this VPN.</p>
</li>
<li>
<p>Click <strong>Add P2</strong> to add a new phase 2 entry.</p>
</li>
</ul>
<p>Now add settings for phase 2 on this VPN. The settings for phase 2:</p>
<ul>
<li><code>General Information</code>
<ul>
<li>Description: A brief description of the network(s) involved in this phase 2 entry.</li>
<li>Mode: Select <em><strong>Tunnel IPv4</strong></em></li>
</ul>
</li>
<li><code>Networks</code>
<ul>
<li>Local Network: <strong>WAN subnet</strong> with interface WAN. <strong>LAN Subnet</strong> with interfaces: OutScope, CDE and NonCDE.</li>
</ul>
</li>
<li><code>NAT/BINAT</code>
<ul>
<li>Set to <strong>None</strong>.</li>
</ul>
</li>
<li><code>Remote Network</code>
<ul>
<li>Set to the network at Site HN, in this case: <code>172.25.49.0/24</code></li>
</ul>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s20.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>The next section of the phase 2 settings covers traffic encryption. Encryption algorithms and Hash algorithms can both be set to allow multiple options in phase 2, and both sides will negotiate and agree upon the settings so long as each side has at least one of each in common. In some cases that may be a good thing, but it is usually better to restrict this to the single specific options desired on both sides.</p>
<ul>
<li>
<p><code>Phase 2 Proposal (SA/Key Exchange)</code></p>
<ul>
<li>Protocol: Set to <strong>ESP</strong> for encryption.</li>
<li>Encryption Algorithms: <strong>AES (128bits)</strong></li>
<li>Hash algorithm use <strong>SHA1</strong></li>
<li>PFS key group with <strong>2(1024bit)</strong></li>
</ul>
</li>
<li>
<p><code>Expiration and Replacement</code> and <code>Keep Alive</code></p>
<ul>
<li>Keep default</li>
</ul>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s22.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><em><strong>NonCDE</strong></em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s23.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s24.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><em><strong>CDE</strong></em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s25.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s26.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s27.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><em><strong>OutScope</strong></em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s28.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s29.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><code>Result:</code></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s30.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h5 class="relative group">Configure Firewall for local connections Site HCM 
    <div id="configure-firewall-for-local-connections-site-hcm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-firewall-for-local-connections-site-hcm" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>In the program menu, select <code>Firewall -&gt; Rules -&gt; WAN</code>. Click the <strong>Add</strong> button.</p>
<ul>
<li>
<p>Protocol: <strong>TCP</strong>, but you can also use Any.</p>
</li>
<li>
<p>Source: <strong>Any</strong>.</p>
</li>
<li>
<p>Destination: <strong>Any</strong>.</p>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s11.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Configure rule OutScope VPN: <code>Firewall -&gt; Rules -&gt; OutScope</code></p>
<ul>
<li>
<p>On the new page we check the parameters:</p>
<ul>
<li>
<p>Customizable interface: <strong>OutScope</strong>.</p>
</li>
<li>
<p>Protocol: <strong>TCP</strong>, but you can also use Any.</p>
</li>
<li>
<p>Source: <strong>Any</strong>.</p>
</li>
<li>
<p>Destination: <strong>Any</strong>.</p>
</li>
</ul>
</li>
<li>
<p>Save the settings by clicking on the Save button.</p>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s14.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Do the same with CDE and Non CDE</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s13.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s12.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Configure rule IPSec VPN: <code>Firewall -&gt; Rules -&gt; IPSec</code></p>
<ul>
<li>
<p>Protocol: <strong>TCP</strong>, but you can also use <strong>Any</strong>.</p>
</li>
<li>
<p>Source: <strong>Any</strong>.</p>
</li>
<li>
<p>Destination: <strong>Any</strong>.</p>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/s2s15.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>It should be noted that the same settings must be made on all remote pfSense servers connected to a single network.</p>


<h5 class="relative group">Config Route table in CMC-Cloud on Site HCM 
    <div id="config-route-table-in-cmc-cloud-on-site-hcm" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#config-route-table-in-cmc-cloud-on-site-hcm" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>A route table contains a set of rules, called routes, that determine where network traffic from your subnet or gateway is directed.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_1.1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_1.2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_2.1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_3.1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_3.2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_5.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S/route_hcm_5.1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>===================================================</p>
<blockquote>
<p>Site HN</p></blockquote>
<p>Now that Site HCM is configured, it is time to tackle Site HN. Repeat the process on the Site HN endpoint to add a tunnel.</p>


<h5 class="relative group">Setup Network on CMC-Cloud Site HN 
    <div id="setup-network-on-cmc-cloud-site-hn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#setup-network-on-cmc-cloud-site-hn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ol>
<li>
<p>Setup IP address of <code>WAN</code> and <code>LAN</code> in portal <code>CMC-Cloud</code>:</p>
<p>Add <strong>IP private</strong> and <strong>IP public</strong>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_cmc_hn.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Setup <strong>security group</strong> in portal CMC-Cloud

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_cmc_hn1.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_cmc_hn2.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p><code>Allowed address pairs</code></p>
<ul>
<li>Double click to open tab <code>Update port</code> -&gt; <strong>Allowed address pairs</strong></li>
<li>Add Security Group</li>
<li>Add <em><code>IP Address or CIDR *</code></em> -&gt; <code>Mac Address</code></li>
<li>Click Add to create a new <strong>Allowed address pairs</strong>.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_cmc_hn3.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_cmc_hn4.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_cmc_hn5.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_cmc_hn6.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ol>


<h5 class="relative group">Configure Interface OutScope, NonCDE, CDE Site HN 
    <div id="configure-interface-outscope-noncde-cde-site-hn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-interface-outscope-noncde-cde-site-hn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>Let&rsquo;s start.</p>
<p>First, configure the internal LAN and the gateway interface. To do this, in the browser, go to the server IP address or domain name if any. Enter the username and password and get to the Home screen (Dashboard). In the program menu, go to the interfaces section <code>Interfaces -&gt; Assignments</code>. In our case, have 3 interfaces are already distributed - we leave it as it is. If you have several interfaces, you should select the necessary interface by mac-address and click the Add button.</p>
<p>Assign an IP address to the interface <strong>“looking”</strong> to the local network.</p>
<ul>
<li>Add interface vtnet1 (OutScope)</li>
<li>Add interface vtnet2 (NonCDE)</li>
<li>Add interface vtnet3 (CDE)</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn.png"
        alt="pfsense"
      />
      
    </figure>


    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn0.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>In the program menu, change interface name <code>interfaces section -&gt; OutScope | NonCDE | CDE</code>. At the end of the setup, click the Save button.</p>
<p>For all servers in the local network, as the default gateway, set the IP address specified in the LAN.</p>
<ul>
<li>
<p>Assign <code>Interface &gt; OutScope</code></p>
<ul>
<li>Setting <code>General Configuration</code>
<ul>
<li>Select <strong>enable interface</strong></li>
<li>IPv4 Type: <strong>DHCP</strong></li>
</ul>
</li>
<li>DHCP Client Configuration
<ul>
<li>Keep default</li>
</ul>
</li>
<li>Reserved Networks
<ul>
<li>Untick <strong>Block private networks and loopback addresses</strong> and <strong>Block bogon networks</strong></li>
</ul>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn7.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn8.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
<li>
<p>Do the same with CDE and Non CDE

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn6.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn6a.png"
        alt="pfsense"
      />
      
    </figure>


    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn4.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn5.png"
        alt="pfsense"
      />
      
    </figure>
</p>
</li>
</ul>
<p><code>Important!</code> If you use cloud services, then you need to unite the network nodes from the administration panel of the cloud service through <code>“Virtual Networks”</code>.</p>


<h5 class="relative group">Configure the IPSec tunnel Site HN 
    <div id="configure-the-ipsec-tunnel-site-hn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-the-ipsec-tunnel-site-hn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p><em><strong><code>Phase 1</code></strong></em></p>
<ul>
<li>Access the <code>VPN &gt; IPSEC &gt; Tunnel</code> section</li>
<li>Click on the <strong>ADD P1</strong> button
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn15.png"
        alt="pfsense"
      />
      
    </figure>
</li>
<li>In the Phase 1 configuration page of the IPsec VPN on the pfsense server, fill in the information according to the configuration similar to IPSec VPN in site HN.
<ul>
<li>
<p><code>General Information</code> Setting</p>
<ul>
<li>Enter a <strong>Description</strong></li>
<li>Uncheck <strong>Disabled</strong> this box so that the tunnel will be operational.</li>
</ul>
</li>
<li>
<p><code>IKE Endpoint Configuration</code></p>
<ul>
<li>Key Exchange version: Specifies whether to use IKEv2 or IKEv1. IKEv2 is the best practice when supported by both endpoints. If one side does not support IKEv2, use <strong>IKEv1</strong> instead.</li>
<li>Internet Protocol: <strong>IPv4</strong> in most cases unless both WANs have IPv6</li>
<li>Interface: Most likely set to <strong>WAN</strong></li>
<li>Remote Gateway: The WAN address at Site HN, in this example: <code>42.96.45.27</code>.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn16.png"
        alt="pfsense"
      />
      
    </figure>
</li>
</ul>
</li>
<li>
<p>Setup <code>Phase 1 Proposal (Authentication)</code></p>
<p>The next section controls IPsec phase 1 proposals for encryption.</p>
<ul>
<li>Authentication Method:The default, <strong>Mutual PSK</strong></li>
<li>Negotiation mode: <strong>Main</strong></li>
<li>My Identifier: <strong>My IP Address</strong></li>
<li>Peer Identifier: <strong>Any</strong></li>
<li>Pre-Shared key: generate a key (we will also need this value on our end)
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn17.png"
        alt="pfsense"
      />
      
    </figure>
</li>
</ul>
</li>
<li>
<p><code>Phase 1 Proposal (Encryption Algorithm)</code></p>
<p>Encryption Algorithm:</p>
<ul>
<li>Algorithm Select <strong>AES</strong></li>
<li>Key length use <strong>128bits</strong></li>
<li>Hash use <strong>SHA256</strong></li>
<li>DH group <strong>2</strong> (1028bit)</li>
</ul>
</li>
<li>
<p><code>Expiration and Replacement</code></p>
<ul>
<li>The Expiration and Replacement section controls the timing and method by which phase 1 will be renegotiated.
<ul>
<li>Life Time: The default <code>28800</code> is OK for this endpoint.</li>
<li>The other lifetime-related values (Rekey Time, Reauth Time, Rand Time) should be left at their defaults on this endpoint as they are automatically calculated as the correct values.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Advanced Options</code></p>
<ul>
<li>Child SA Close Action: Set this endpoint to <strong>Default</strong>. Moreover, have options <strong>Restart/Reconnect</strong> so that the phase 2 entries will be reconnected if they get disconnected.</li>
<li>Leave checked and at the default values.

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn18.png"
        alt="pfsense"
      />
      
    </figure>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong> when complete</p>
</li>
</ul>
</li>
</ul>
<p><em><strong><code>Phase 2</code></strong></em></p>
<p>With the phase 1 entry complete, now a new phase 2 definition to the VPN:</p>
<ul>
<li>
<p>Click <strong>Show Phase 2 Entries</strong> to expand the phase 2 list for this VPN.</p>
</li>
<li>
<p>Click <strong>Add P2</strong> to add a new phase 2 entry.</p>
</li>
</ul>
<p>Now add settings for phase 2 on this VPN. The settings for phase 2:</p>
<ul>
<li><code>General Information</code>
<ul>
<li>Description: A brief description of the network(s) involved in this phase 2 entry.</li>
<li>Mode: Select <em><strong>Tunnel IPv4</strong></em></li>
</ul>
</li>
<li><code>Networks</code>
<ul>
<li>Local Network: <strong>WAN subnet</strong> with interface WAN. <strong>LAN Subnet</strong> with interfaces: OutScope, CDE and NonCDE.</li>
</ul>
</li>
<li><code>NAT/BINAT</code>
<ul>
<li>Set to <strong>None</strong>.</li>
</ul>
</li>
<li><code>Remote Network</code>
<ul>
<li>Set to the network at Site HN, in this case: <code>172.24.49.0/24</code></li>
</ul>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn19.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p>The next section of the phase 2 settings covers traffic encryption. Encryption algorithms and Hash algorithms can both be set to allow multiple options in phase 2, and both sides will negotiate and agree upon the settings so long as each side has at least one of each in common. In some cases that may be a good thing, but it is usually better to restrict this to the single specific options desired on both sides.</p>
<ul>
<li>
<p><code>Phase 2 Proposal (SA/Key Exchange)</code></p>
<ul>
<li>Protocol: Set to <strong>ESP</strong> for encryption.</li>
<li>Encryption Algorithms: <strong>AES (128bits)</strong></li>
<li>Hash algorithm use <strong>SHA1</strong></li>
<li>PFS key group with <strong>2(1024bit)</strong></li>
</ul>
</li>
<li>
<p><code>Expiration and Replacement</code> and <code>Keep Alive</code></p>
<ul>
<li>Keep default</li>
</ul>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn20.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><em><strong>NonCDE</strong></em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn21.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn22.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><em><strong>CDE</strong></em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn23.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn24.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><em><strong>OutScope</strong></em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn25.png"
        alt="pfsense"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn26.png"
        alt="pfsense"
      />
      
    </figure>
</p>
<p><code>Result:</code></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn28.png"
        alt="pfsense"
      />
      
    </figure>
</p>


<h5 class="relative group">Configure Firewall for local connections Site HN 
    <div id="configure-firewall-for-local-connections-site-hn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#configure-firewall-for-local-connections-site-hn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>In the program menu, select <code>Firewall -&gt; Rules -&gt; WAN</code>. Click the <strong>Add</strong> button.</p>
<ul>
<li>
<p>Protocol: <strong>TCP</strong>, but you can also use Any.</p>
</li>
<li>
<p>Source: <strong>Any</strong>.</p>
</li>
<li>
<p>Destination: <strong>Any</strong>.</p>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn11.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Configure rule OutScope VPN: <code>Firewall -&gt; Rules -&gt; OutScope</code></p>
<ul>
<li>
<p>On the new page we check the parameters:</p>
<ul>
<li>
<p>Customizable interface: <strong>OutScope</strong>.
Imgs/S2S-HN/hn23.png</p>
</li>
<li>
<p>Protocol: <strong>TCP</strong>, but you can also use Any.</p>
</li>
<li>
<p>Source: <strong>Any</strong>.</p>
</li>
<li>
<p>Destination: <strong>Any</strong>.</p>
</li>
</ul>
</li>
<li>
<p>Save the settings by clicking on the Save button.</p>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn13.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Do the same with CDE and Non CDE</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn12.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn11.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Configure rule IPSec VPN: <code>Firewall -&gt; Rules -&gt; IPSec</code></p>
<ul>
<li>
<p>Protocol: <strong>TCP</strong>, but you can also use <strong>Any</strong>.</p>
</li>
<li>
<p>Source: <strong>Any</strong>.</p>
</li>
<li>
<p>Destination: <strong>Any</strong>.</p>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/hn14.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>It should be noted that the same settings must be made on all remote pfSense servers connected to a single network.</p>


<h5 class="relative group">Config Route table in CMC-Cloud on Site HN 
    <div id="config-route-table-in-cmc-cloud-on-site-hn" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#config-route-table-in-cmc-cloud-on-site-hn" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>A route table contains a set of rules, called routes, that determine where network traffic from your subnet or gateway is directed.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_subnet.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route4.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route5.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route6.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/S2S-HN/s2s_hn_route7.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h3 class="relative group">Build VPN Route Base (Using OSPF) 
    <div id="build-vpn-route-base-using-ospf" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#build-vpn-route-base-using-ospf" aria-label="Anchor">#</a>
    </span>        
    
</h3>


<h4 class="relative group">Routed IPsec (VTI) 
    <div id="routed-ipsec-vti" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#routed-ipsec-vti" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Route-based IPsec is an alternative method of managing IPsec traffic. It uses <code>if_ipsec(4)</code> from FreeBSD for <strong>Virtual Tunnel Interfaces (VTI)</strong> and traffic is directed using the operating system routing table. It does not rely on strict kernel security association matching like policy-based (tunnel mode) IPsec.</p>
<p>Virtual Tunnel Interface (VTI) tunnels in pfSense are used to create a more streamlined way to handle IPsec VPN configurations. VTI tunnels simplify the process of creating site-to-site VPNs by treating the tunnel as a network interface, allowing for easier management and the ability to use dynamic routing protocols like <strong><code>OSPF</code></strong> or <strong><code>BGP</code></strong>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/VTI_TUNNEL.svg"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>VPN Route-Based IPSEC</p></blockquote>


<h5 class="relative group">HANOI - Khanh&rsquo;s zone (Vùng 1) - PHAN 
    <div id="hanoi---khanhs-zone-v%C3%B9ng-1---phan" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#hanoi---khanhs-zone-v%C3%B9ng-1---phan" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<table>
  <thead>
      <tr>
          <th>FW - IP public</th>
          <th>Interface</th>
          <th>IP address</th>
          <th>Subnet</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>42.98.43.148</td>
          <td>WAN</td>
          <td>172.25.48.81</td>
          <td>172.25.48.0/24</td>
      </tr>
      <tr>
          <td></td>
          <td>LAN</td>
          <td>172.25.68.10</td>
          <td>172.25.84.0/24</td>
      </tr>
      <tr>
          <td></td>
          <td>VTI</td>
          <td>10.0.0.1</td>
          <td></td>
      </tr>
      <tr>
          <td>PC</td>
          <td>LAN</td>
          <td>172.25.64.193</td>
          <td>172.25.84.0/24</td>
      </tr>
  </tbody>
</table>


<h5 class="relative group">HCM - Khanh&rsquo;s zone (Vùng 2) - GIANG 
    <div id="hcm---khanhs-zone-v%C3%B9ng-2---giang" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#hcm---khanhs-zone-v%C3%B9ng-2---giang" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<table>
  <thead>
      <tr>
          <th>FW - IP public</th>
          <th>Interface</th>
          <th>IP address</th>
          <th>Subnet</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>42.98.44.213</td>
          <td>WAN</td>
          <td>172.21.2.154</td>
          <td>172.21.0.0/20</td>
      </tr>
      <tr>
          <td></td>
          <td>VTI-toHN</td>
          <td>10.0.0.2</td>
          <td></td>
      </tr>
      <tr>
          <td></td>
          <td>VTI-toTRAM</td>
          <td>10.0.0.3</td>
          <td></td>
      </tr>
  </tbody>
</table>


<h5 class="relative group">HCM - Tram&rsquo;s zone (Vùng 3) - TRI 
    <div id="hcm---trams-zone-v%C3%B9ng-3---tri" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#hcm---trams-zone-v%C3%B9ng-3---tri" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<table>
  <thead>
      <tr>
          <th>FW - IP public</th>
          <th>Interface</th>
          <th>IP address</th>
          <th>Subnet</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>203.171.92.107</td>
          <td>WAN</td>
          <td>192.168.2.200</td>
          <td>192.168.0.0/24</td>
      </tr>
      <tr>
          <td></td>
          <td>LAN</td>
          <td>192.168.0.211</td>
          <td>192.168.0.0/24</td>
      </tr>
      <tr>
          <td></td>
          <td>VTI</td>
          <td>10.0.0.4</td>
          <td></td>
      </tr>
      <tr>
          <td>PC</td>
          <td>LAN</td>
          <td>192.168.0.210</td>
          <td>192.168.0.0/24</td>
      </tr>
  </tbody>
</table>
<p>Config in Phase1: <strong><code>AES128 - SHA1 - DH Group 2</code></strong></p>
<ul>
<li>
<p>Key between zone 3 and zone 2:</p>
<pre tabindex="0"><code class="language-key" data-lang="key">4531f5a38fa3e74c8741c743aae8b7fd7ef4fec037f500d8ad1fa7e91
</code></pre></li>
<li>
<p>Key between zone 1 and zone 2:</p>
<pre tabindex="0"><code class="language-key" data-lang="key"> 7751417e85b68855909314a7da81cbb2271efd65a801f4bc0118d8da
</code></pre></li>
</ul>


<h4 class="relative group">Step 1: Configure IPsec Tunnel on pfSense 
    <div id="step-1-configure-ipsec-tunnel-on-pfsense" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-1-configure-ipsec-tunnel-on-pfsense" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<ol>
<li>
<p>Go to <code>VPN &gt; IPsec</code> in the pfSense web GUI.</p>
</li>
<li>
<p>Click on the + Add P1 button to create a new Phase 1 entry.</p>
</li>
<li>
<p>Set the following parameters for the Phase 1 configuration:</p>
<ul>
<li>Key Exchange version: IKEv1</li>
<li>Remote Gateway: IP address of the remote VPN endpoint</li>
<li>Authentication Method: Mutual PSK (Pre-Shared Key)</li>
<li>Pre-Shared Key: Enter a secure key</li>
<li>Encryption Algorithm: Choose a strong encryption method (e.g., AES)</li>
<li>Hash Algorithm: SHA-1 (or another secure hash)</li>
<li>DH Group: Choose an appropriate Diffie-Hellman group</li>
</ul>
</li>
</ol>
<blockquote>
<p>HANOI - Khanh&rsquo;s zone (Vùng 1)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_1_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_1_2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_1_3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2)</p></blockquote>
<ul>
<li>toHCM-MrTram</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_1.png"
        alt="vti"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_2.png"
        alt="vti"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_3.png"
        alt="vti"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_4.png"
        alt="vti"
      />
      
    </figure>
</p>
<ul>
<li>HCM-to-HN</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_1.1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_2.2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_3.3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_4.4.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Tram&rsquo;s zone (Vùng 3)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_3_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_3_2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zone_3_3.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h4 class="relative group">Step 2: Configure Phase 2 (Child SA) for VTI 
    <div id="step-2-configure-phase-2-child-sa-for-vti" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-2-configure-phase-2-child-sa-for-vti" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<ol>
<li>
<p>Click on + Add P2 under the Phase 1 you just created.</p>
</li>
<li>
<p>Set the following parameters for the Phase 2 configuration:</p>
<ul>
<li>Mode: Tunnel IPv4</li>
<li>Local Network: Network Address, and enter an IP address in CIDR notation (e.g., 0.0.0.0/0 for all traffic)</li>
<li>Remote Network: Network Address, and enter 0.0.0.0/0</li>
<li>Protocol: ESP</li>
<li>Encryption Algorithms: Choose strong encryption settings (e.g., AES)</li>
<li>Hash Algorithms: Choose a secure hash (e.g., SHA-256)</li>
</ul>
</li>
<li>
<p>In the Phase 2 proposal (SA/Key Exchange) section, set the following:</p>
<ul>
<li>Lifetime: Set a reasonable value (e.g., 3600 seconds)</li>
<li>Enable Automatically ping host, if desired, to keep the tunnel alive.</li>
</ul>
</li>
<li>
<p>Save the Phase 2 settings.</p>
</li>
</ol>
<blockquote>
<p>HANOI - Khanh&rsquo;s zone (Vùng 1)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_1_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_1_2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_1_4.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2)</p>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2) connect to HANOI - Khanh&rsquo;s zone (Vùng 1)</p></blockquote></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2_2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2_3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2) connect to HCM - Tram&rsquo;s zone (Vùng 3)</p></blockquote></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2.2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2.2_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2.2_2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_2.2_3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Tram&rsquo;s zone (Vùng 3)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_3_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_3_2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_3_3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_p2_3_4.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h4 class="relative group">Create the VTI Interface 
    <div id="create-the-vti-interface" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#create-the-vti-interface" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<ol>
<li>Go to Interfaces &gt; Assignments in the pfSense web GUI.</li>
<li>You should see a new interface named IPsec VTI available in the list.</li>
<li>Click Add to assign the IPsec VTI interface.</li>
<li>Click on the newly created interface and configure it:
<ul>
<li>Enable the interface</li>
<li>Set the IP Address (e.g., 10.0.0.1/30), where each end of the tunnel gets a unique IP in the subnet.</li>
</ul>
</li>
<li>Save and apply the changes.</li>
</ol>
<blockquote>
<p>HANOI - Khanh&rsquo;s zone (Vùng 1)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo1_interface.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo1_interface1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo1_interface2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo2_interface.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo2_interface1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo2_interface2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo2_interface3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo2_interface4.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Tram&rsquo;s zone (Vùng 3)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo3_interface.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo3_interface1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_zo3_interface2.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h4 class="relative group">Step 4: Firewall Rules for the VTI Interface 
    <div id="step-4-firewall-rules-for-the-vti-interface" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-4-firewall-rules-for-the-vti-interface" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<ol>
<li>Go to Firewall &gt; Rules and click on the newly created IPsec VTI interface.</li>
<li>Add rules to allow traffic to flow through the tunnel as needed.
For example, add a rule to allow all traffic for testing purposes.</li>
<li>Save and apply the firewall rules.</li>
</ol>
<p>Exp: Add rules to allow traffic for 3 zone.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_rules.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_rules1.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h4 class="relative group">Testing the VTI Tunnel 
    <div id="testing-the-vti-tunnel" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#testing-the-vti-tunnel" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<ol>
<li>Ping the remote tunnel IP address to verify connectivity.</li>
<li>Ensure that traffic is being properly routed through the VTI tunnel.</li>
</ol>
<blockquote>
<p>HANOI - Khanh&rsquo;s zone (Vùng 1)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_tunnel_ping_z1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_tunnel_ping_z1_2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_tunnel_ping_z2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_tunnel_ping_z2_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_tunnel_ping_z2_2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Tram&rsquo;s zone (Vùng 3)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_tunnel_ping_z3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_tunnel_ping_z3_1.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h4 class="relative group">Step 5: Setup for OSPF on pfSense with VTI 
    <div id="step-5-setup-for-ospf-on-pfsense-with-vti" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#step-5-setup-for-ospf-on-pfsense-with-vti" aria-label="Anchor">#</a>
    </span>        
    
</h4>


<h5 class="relative group">I. Install the FRR Package on pfSense 
    <div id="i-install-the-frr-package-on-pfsense" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#i-install-the-frr-package-on-pfsense" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ol>
<li>Go to System &gt; Package Manager &gt; Available Packages.</li>
<li>Search for the FRR (Free Range Routing) package.</li>
<li>Click Install to add the package to your pfSense setup.</li>
<li>Once the installation is complete, go to Services &gt; FRR Global/Zebra.</li>
</ol>
<blockquote>
<p>[!NOTE]
Install FRR on all 3 zones</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_pkg.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_pkg1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_pkg2.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h5 class="relative group">II. Configure FRR Global Settings 
    <div id="ii-configure-frr-global-settings" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ii-configure-frr-global-settings" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ol>
<li>Enable the FRR daemon by checking the box at the top of the page.</li>
<li>Make sure the Zebra routing manager is enabled.</li>
<li>Save and apply the settings.</li>
</ol>
<blockquote>
<p>[!NOTE]
Enable FRR on all 3 zones</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_frr_cfg1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_frr_cfg2.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h5 class="relative group">III. Configure OSPF in FRR 
    <div id="iii-configure-ospf-in-frr" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#iii-configure-ospf-in-frr" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ol>
<li>Navigate to <code>Services &gt; FRR OSPF</code>.</li>
<li>Check the box to <strong>Enable OSPF</strong>.</li>
<li>In the Router ID field keep default or enter a unique identifier for this pfSense router (typically the LAN IP address).</li>
<li>Under Networks, add the network associated with the VTI interface. For example:
<ul>
<li>Network: 10.10.10.0/30 (replace this with your actual VTI network)</li>
<li>Area: 0.0.0.0 (Area 0 is the backbone area for OSPF)</li>
</ul>
</li>
<li>Click Save to apply these settings.</li>
</ol>
<blockquote>
<p>OSPF config</p></blockquote>
<p>OSPF setting

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Areas setting</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_area.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_area1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_area2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<p>Interface setting</p>
<ul>
<li>HANOI - Khanh&rsquo;s zone (Vùng 1)</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_hn.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_hn1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_hn2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>HCM - Khanh&rsquo;s zone (Vùng 2)</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_z2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_z21.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_z22.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>HCM - Tram&rsquo;s zone (Vùng 3)</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_z3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_z31.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_interface_z32.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h5 class="relative group">IV. Configure Static Routing in Pfsense 
    <div id="iv-configure-static-routing-in-pfsense" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#iv-configure-static-routing-in-pfsense" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ol>
<li>Navigate to <code>System &gt; Routing &gt; Static Routes</code>.</li>
<li>Select + <strong>Add</strong> button to create a new static route.</li>
<li>Configure the Static Route:
<ul>
<li>Destination network: Enter the destination network (e.g., 192.168.2.0/24).</li>
<li>Gateway: Select the gateway that pfSense should use to reach the destination network. Ở đây chúng ta sử dụng gateway vti.</li>
<li>Optionally, you can add a Description for the route.</li>
</ul>
</li>
<li>Click <strong>Save</strong> to <strong>apply</strong> activate the new route..</li>
</ol>
<blockquote>
<p>HANOI - Khanh&rsquo;s zone (Vùng 1)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_hn.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_hn1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_hn2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_z2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_z2_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_z2_2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Tram&rsquo;s zone (Vùng 3)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_z3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_z3_1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_routes_z3_2.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h5 class="relative group">V. Check status OSPF in FRR 
    <div id="v-check-status-ospf-in-frr" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#v-check-status-ospf-in-frr" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<ol>
<li>Navigate to <code>Status &gt; FRR</code>.</li>
<li>Select  <strong>OSPF</strong> button to query status service ospf.</li>
</ol>
<blockquote>
<p>HANOI - Khanh&rsquo;s zone (Vùng 1)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone1.1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone1.2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone1.3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone1.4.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Khanh&rsquo;s zone (Vùng 2)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone2.1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone2.2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone2.3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone2.4.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>HCM - Tram&rsquo;s zone (Vùng 3)</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone3.1.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone3.2.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone3.3.png"
        alt="alt text"
      />
      
    </figure>

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/vti_ospf_stt_zone3.4.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h5 class="relative group">V. Check ping 
    <div id="v-check-ping" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#v-check-ping" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<blockquote>
<p>Access the PC on zone 1, add route and perform ping test.</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo1_to_zo3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>Show route before add new route</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo1_to_zo3_1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>Add route and ping to Lan</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo1_to_zo3_2.png"
        alt="alt text"
      />
      
    </figure>


    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo1_to_zo3_3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>Ping to PC</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo1_to_zo3_4.png"
        alt="alt text"
      />
      
    </figure>
</p>
<blockquote>
<p>Access the PC on zone 3, add route and perform ping test.</p></blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo3_to_zo1.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>Show route before add new route</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo3_to_zo1_1.png"
        alt="alt text"
      />
      
    </figure>


    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo3_to_zo1_2.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>Add route and ping to Lan</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo3_to_zo1_3.png"
        alt="alt text"
      />
      
    </figure>
</p>
<ul>
<li>Ping to PC</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/posts/pfsense/Imgs/Route-base/ping_zo3_to_zo1_5.png"
        alt="alt text"
      />
      
    </figure>
</p>


<h3 class="relative group">Build VPN With GRE-TUNNEL 
    <div id="build-vpn-with-gre-tunnel" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#build-vpn-with-gre-tunnel" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Generic Routing Encapsulation (GRE) is a method of tunneling traffic between two endpoints without encryption. It can be used to route packets between two locations that are not directly connected, which do not require encryption. It can also be combined with a method of encryption that does not perform its own tunneling.</p>
<blockquote>
<p>[!NOTE]
The GRE protocol was originally designed by Cisco, and it is the default tunneling mode on many of their devices.</p></blockquote>
<p>GRE tunnels can carry either IPv4, IPv6, or both types of traffic at the same time.</p>
<p>End.</p>

          
          
          
        </div>
        
        

        
        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:1313/posts/pfsense/&amp;title=Install%20and%20config:%20Pfsense"
      title="Share on LinkedIn"
      aria-label="Share on LinkedIn"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=http://localhost:1313/posts/pfsense/&amp;text=Install%20and%20config:%20Pfsense"
      title="Tweet on Twitter"
      aria-label="Tweet on Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://api.whatsapp.com/send?text=http://localhost:1313/posts/pfsense/&amp;resubmit=true&amp;title=Install%20and%20config:%20Pfsense"
      title="Share via WhatsApp"
      aria-label="Share via WhatsApp"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://t.me/share/url?url=http://localhost:1313/posts/pfsense/&amp;resubmit=true&amp;title=Install%20and%20config:%20Pfsense"
      title="Share via Telegram"
      aria-label="Share via Telegram"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://pinterest.com/pin/create/bookmarklet/?url=http://localhost:1313/posts/pfsense/&amp;description=Install%20and%20config:%20Pfsense"
      title="Pin on Pinterest"
      aria-label="Pin on Pinterest"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://reddit.com/submit/?url=http://localhost:1313/posts/pfsense/&amp;resubmit=true&amp;title=Install%20and%20config:%20Pfsense"
      title="Submit to Reddit"
      aria-label="Submit to Reddit"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:1313/posts/pfsense/&amp;quote=Install%20and%20config:%20Pfsense"
      title="Share on Facebook"
      aria-label="Share on Facebook"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=http://localhost:1313/posts/pfsense/&amp;subject=Install%20and%20config:%20Pfsense"
      title="Send via email"
      aria-label="Send via email"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/posts/install/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/img/banner.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/posts/install/">Reading Papers: CIReVL (ICLR 2024)</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-10-31T20:28:53&#43;07:00">31 October 2024</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">2 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/reading-papers/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Reading Papers
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cir/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CIR
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/llm/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Llm
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/visual/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Visual
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/music/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/img/banner.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/music/">Music</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          





























<div class="flex flex-row flex-wrap items-center">
  
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>







        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/projects/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/img/banner.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/projects/">Projects</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          





























<div class="flex flex-row flex-wrap items-center">
  
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>







        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/resume/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/img/banner.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/resume/">Resume</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          





























<div class="flex flex-row flex-wrap items-center">
  
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>







        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
</section>

  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\\Pfsense\\index.md"
        var oid_likes = "likes_posts\\Pfsense\\index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/posts/install/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Reading Papers: CIReVL (ICLR 2024)</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-10-31T20:28:53&#43;07:00">31 October 2024</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="Tags">
            
            Tags
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/categories/"
            title="Categories">
            
            Categories
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/authors/"
            title="Authors">
            
            Authors
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2025
      Truong-Giang Nguyen
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
  data-id="gangi" data-description="Support me on Buy me a coffee!" data-message=""
  data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

</html>
